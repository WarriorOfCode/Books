<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title><%= book[0].Name %></title>

	<% include	includes/header.ejs %>
	
	<div class="row-fluid">
		<div class="col-sm-3 book-image">
			<img src="<%= book[0].image_url %>" class="img-rounded" alt="<%= book[0].Name %>">
			<div ng-controller="ReadCtrl">
				<% if (login) { %>

				<button class="btn btn-default btn-block" ng-class="{'btn-primary':isReaded}" ng-click="action()">{{ text }}</button>
				
				<uib-rating ng-model="rate" max="10" readonly="isReadonly" on-hover="hoveringOver(value)" on-leave="overStar = null" aria-labelledby="default-rating" ng-click="sendMark(rate)"></uib-rating>
				<span class="label" ng-class="{'label-danger': overStar<=3, 'label-warning': overStar>3 && overStar<7, 'label-success': overStar>=7}" ng-show="overStar && !isReadonly">{{overStar}}</span>

				<span class="label" ng-class="{'label-danger': oldmark<=3, 'label-warning': oldmark>3 && oldmark<7, 'label-success': oldmark>=7}" ng-show="oldmark && isReadonly">{{oldmark}}</span><br/>

				<button type="button" class="btn btn-sm btn-danger" ng-click="deleteMark()" ng-disabled="!isReadonly">Delete mark</button>
    			<button type="button" class="btn btn-sm btn-default" ng-click="isReadonly = false">change mark </button>

				<% } %>
			</div>
		</div>

		<div class="col-sm-9">
			<h1><%= book[0].Name %></h1>
			<p><%= book[0].Description %></p><br/>
			<p><b>Дата первого издания:</b> <%= book[0].Birth_data %></p><br/>
			<p><b>Автор: </b>
				<a href='/author/<%= author[0].id %>'>
					<%= author[0].Name %>
					<% if (author[0].patronymic) { %>
						<%= author[0].patronymic %> 
					<% } %>
					<%= author[0].Last_Name %>
				</a>
			</p>
			<div ng-controller="ListCtrl" ng-show="lists"><b>Списки:</b>
					<span ng-repeat="list in lists"><a href="/list/{{list.id}}">{{list.Name}} </a></span>
			</div>


			<div ng-controller="ReviewCtrl">
				<% if (login) { %>
					<input type="button" ng-hide="buttonHide" class="btn btn-default" value="Оставить отзыв" ng-click="checked=!checked">

	 				<form ng-show="checked" class="form-horizontal">

		 				<div class="form-group">
		 					<label class="col-sm-3 control-label">Загаловок отзыва:</label>
							<div class="col-sm-6">
		 						<input type="text" class="form-control" ng-model="review.head" placeholder="Загаловок отзыва">
		 					</div>
		 				</div>

		 				<div class="form-group">
							<label class="col-sm-3 control-label">Отзыв:</label>
							<div class="col-sm-6">
								<textarea type="text" ng-model="review.body" class="form-control" placeholder="Отзыв" rows = "6"></textarea>
							</div>
						</div>

						<div class="form-group">
							<div class="col-sm-offset-3 col-sm-5">
								<button  ng-click="send()" class="btn btn-default">Save</button>
								<button  ng-click="review=null" class="btn btn-default">Cancel</button>
							</div>
						</div>

					</form>
				<% } %>

				<div ng-show="reviews"><h3>Отзывы: </h3>
					<div ng-repeat="review in reviews">
						<blockquote>
							<a href="/user/{{review.id_user}}">{{review.NickName}}</a>
							<span>{{review.birthDate | date:'dd-MM-yyyy'}}</span>
						<h4><b>{{review.title}}</b></h4>
						<div>
							{{review.text}}
						</div>
					</blockquote>
				</div>

			</div>

		</div>
	</div>

	<script>
		window.App = {
			isReaded: <%= isReaded %>,
			login: "<%= login %>"
		}
	</script>
	
	
	<% include includes/scripts.ejs %>
 	<script src="/js/book.js"></script>

</body>
</html>